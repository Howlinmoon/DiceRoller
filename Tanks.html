<!doctype html>
<html>
<head>
	<meta charset=utf-8>
	<title>Tanks</title>
	<style>
		body { margin: 40px; background: #666; }
		#my_canvas { background: #fff; border: #000 1px solid;}
	</style>
	
	<script>
	
	
	var enemyTankBase = new Image();
	enemyTankBase.src = "graphics/ETankBottom/Default/000.png";
	var enemyTankGun = new Image();
	enemyTankGun.src = "graphics/ETankTop/Default/000.png";
	
	var playerTankBase = new Image();
	playerTankBase.src = "graphics/TankBottom/Default/000.png";
	var playerTankGun = new Image();
	playerTankGun.src = "graphics/ETankTop/Default/000.png";

    // declare an array to hold a bunch of enemy tank objects
    var enemyTanks = [];

	
	// This class is for all entities that move around the map
	function VehicleClass () {
		// Vehicles have these common properties:
		// X location, Y location,  Direction (heading), Velocity, damage (health)
		// a graphic image
		// and an Id?
		this.x = 0, this.y = 0, this.heading = 0, this.health = 100, this.id = 0, this.velocity = 0;
		this.vehicleImage = new Image();
	}
	

	// establish a class for the Tanks

	function TankClass() {
		// the tanks require these additional properties:
		// direction of  turret
		// gun ammo,  mine ammo
		// current target X,Y
		// target acquired true/false
		this.turretDir = 0, this.gunAmmo = 100, this.mines = 10, this.targetX = 0, this.targetY = 0, this.targetAcquired = false;
		this.tankMethod = function tankMethod(arg1) {
			return arg1 + " Tank Method reporting for duty - ID: "+this.id;
		}
	}

	// Establish a class for enemy tanks
	function EnemyTankClass(arg1) {
		// enemy tanks require these additional properties:
		// a graphic image, a behavior
		this.vehicleImage = enemyTankBase, this.behavior = "aggressive";
		this.enemyTankMethod = function enemyTankMethod(arg1) {
			return arg1 + "Enemy Tank Method reporting for duty - ID: "+this.id;
		}
		// assign the passed Id to the tank
		this.id = arg1;
	}

	// Make the child class inherit all of the parent class characteristics
	// by using the prototype property

	// First, we make the tank class inherit the base vehicle class
	TankClass.prototype = new VehicleClass();

	// Next, we make the enemy tank class inherit the base tank class
	EnemyTankClass.prototype = new TankClass;

	// At this point, the following should create a new enemy tank object:
	var enemyTank1 = new EnemyTankClass('666');

	// Attempt to verify the classes are working correctly
	console.log("enemyTank1 - checking EnemyTankClass behavior property: "+enemyTank1.behavior);
	console.log("enemyTank1 - calling the EnemyTankClass enemyTankMethod: "+enemyTank1.enemyTankMethod(' sample data '));
	console.log("enemyTank1 - Displaying how many mines are available: "+enemyTank1.mines);
	console.log("enemyTank1 - calling tankMethod with argument '999' "+enemyTank1.tankMethod('999'));

	
	
	var enemyTank = new Image();
	enemyTank.src = "graphics/ETankBottom/Default/000.png";
	
	var enemyTankGun = new Image();
	enemyTankGun.src = "graphics/ETankTop/Default/000.png";
	
	var tankTread = new Image();
	tankTread.src = "graphics/TankTread/Default/000.png";
	
	var backgroundImage = new Image();
	backgroundImage.src = "graphics/tiledbackground.png";
	
	var TO_RADIANS = Math.PI/180; 
     var angle = 0;
     var ctx = 0;
     
     var eTankX = 500;
     var eTankY = 500;
     var eTankDir = 3;
     
     
   

	function InitGame() {
		ctx = document.getElementById('my_canvas').getContext('2d');
		console.log(ctx.canvas.id+" | "+ctx.canvas.width+" | "+ctx.canvas.height);
		
		// create a bunch of enemy tanks
		for (var tankCounter = 1; tankCounter <= 50; tankCounter ++ ) {
			// Spawn a new enemy tank, and assign it's id
			var newEnemyTankObject = new EnemyTankClass(tankCounter);
			// assign initial X and Y co-ords
			// randomize them anywhere on the canvas - minus a 100 pix border
			newEnemyTankObject.x = Math.floor(Math.random() * (ctx.canvas.width - 100)) + 1;
			newEnemyTankObject.y = Math.floor(Math.random() * (ctx.canvas.height - 100)) + 1;
			// randomize a heading (1 - 4)
			newEnemyTankObject.heading = Math.floor(Math.random() * 4) + 1;

			// add this new tank to our array
			enemyTanks.push(newEnemyTankObject);
			console.log("Added tank "+tankCounter+" added to the array");
		}
		
		// how many enemy tanks in the array?
		console.log("Size of enemy tank array: "+enemyTanks.length);
		
		
        setInterval("animate()", 100);
	
	}
	
	function animate() {
		// Draw the background
	    var ptrn = ctx.createPattern(backgroundImage, 'repeat'); // Create a pattern with this image, and set it to "repeat".
		// save the state of the context
	    ctx.save(); 
	    ctx.fillStyle = ptrn;
	    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height); // context.fillRect(x, y, width, height);
	    // restore the state
	    ctx.restore();
		
		
		// increment our global angle
		angle += 10;
		if (angle > 360) {
			angle = 0;
		}

		
		// Draw the enemy tanks
//		console.log("eTankDir: "+eTankDir);
//		console.log("eTankX: "+eTankX);
//		console.log("eTankY: "+eTankY);
		
		for (var tankNumber = 1; tankNumber < enemyTanks.length; tankNumber++ ) {
			//console.log("Tank number: "+tankNumber+", current heading: "+enemyTanks[tankNumber].heading);
			switch (enemyTanks[tankNumber].heading) {
			case 1:
				enemyTanks[tankNumber].x += 5;
				if (enemyTanks[tankNumber].x > (ctx.canvas.width - 50 ) ) {
					enemyTanks[tankNumber].heading = 2;
				}
				break;
	
			case 2:
				enemyTanks[tankNumber].y -= 5;
				if (enemyTanks[tankNumber].y < 50 ) {
					enemyTanks[tankNumber].heading = 3;
				}
				break;
	
			case 3:
				enemyTanks[tankNumber].x -= 5;
				if (enemyTanks[tankNumber].x < 50 ) {
					enemyTanks[tankNumber].heading = 4;
				}
				break;
	
			case 4:
				enemyTanks[tankNumber].y += 5;
				if (enemyTanks[tankNumber].y > (ctx.canvas.height - 50 ) ) {
					enemyTanks[tankNumber].heading = 1;
				}
				break;
	
			}
			
			//console.log("gun width: "+enemyTankGun.width+", height: "+enemyTankGun.height);
			// gun width: 72, height: 42
			
			drawRotatedImage(enemyTanks[tankNumber].vehicleImage, enemyTanks[tankNumber].x, enemyTanks[tankNumber].y, (enemyTanks[tankNumber].heading - 1) * 90, ctx);
			// and the gun - always point it at the center of the map
			// var angleDeg = Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI;
			var centerX = ctx.canvas.width / 2;
			var centerY = ctx.canvas.height / 2;
			var gunAngle =  Math.atan2(centerY - enemyTanks[tankNumber].y, centerX - enemyTanks[tankNumber].x) * 180 / Math.PI;
	
	//		drawRotatedImage(enemyTankGun, eTankX +gunXd, eTankY+gunYd, gunAngle, ctx);
			ctx.save();
			ctx.translate(enemyTanks[tankNumber].x,  enemyTanks[tankNumber].y);
			ctx.rotate(gunAngle * Math.PI/180);
			ctx.drawImage(enemyTankGun, -20, -22);
			ctx.restore();

		}
		
/*
		drawRotatedImage(enemyTank,136, 121, 0 * 90, ctx);
		var deg = angle;
		ctx.save();
		ctx.translate(136, 121);
		ctx.rotate(deg * Math.PI/180);
		ctx.drawImage(enemyTankGun, -20, -22);
		ctx.restore();
*/
      	
	}
	
	
	function drawRotatedImage(image, x, y, angle, ctx) { 
	 
		// save the current co-ordinate system 
		// before we screw with it
		ctx.save(); 
	 
		// move to the middle of where we want to draw our image
		ctx.translate(x, y);
	 
		// rotate around that point, converting our 
		// angle from degrees to radians 
		ctx.rotate(angle * TO_RADIANS);
	 
		// draw it up and to the left by half the width
		// and height of the image 
		ctx.drawImage(image, -(image.width/2), -(image.height/2));
	 
		// and restore the co-ords to how they were when we began
		ctx.restore(); 
	}
	
	function randomNumber( min, max ) {
		return Math.floor(Math.random() * (max - min)) + min;
	}

	window.addEventListener('load', function(event) {
		InitGame();
	});

	</script>
	
</head>

<body>
<!-- 
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
-->
<script>

</script>

<canvas id="my_canvas" width="1280" height = "1024"></canvas>


</body>
</html>

